{"version":3,"sources":["header.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"header.js","sourcesContent":["Selectize.define( 'preserve_on_blur', function( options ) {\r\n    var self = this;\r\n\r\n    options.text = options.text || function(option) {\r\n        return option[this.settings.labelField];\r\n    };\r\n\r\n    this.onBlur = ( function( e ) {\r\n        var original = self.onBlur;\r\n\r\n        return function( e ) {\r\n            // Capture the current input value\r\n            var $input = this.$control_input;\r\n            var inputValue = $input.val();\r\n\r\n            // Do the default actions\r\n            original.apply( this, e );\r\n\r\n            // Set the value back\r\n            this.setTextboxValue( inputValue );\r\n        };\r\n    } )();\r\n} );\r\n\r\n$(document).ready(function(){\r\n\r\n    if(!localStorage.getItem(\"showSearchHint\")  ){\r\n        $('#input-tags6').popover();\r\n\r\n\r\n    }\r\n\r\n    $('#input-tags6').blur(function () {\r\n        $('#input-tags6').popover('disable');\r\n    });\r\n\r\n\r\n\r\n\r\n    function debounce(func, wait, immediate) {\r\n        var timeout;\r\n        console.log(1);\r\n        return function() {\r\n            var context = this, args = arguments;\r\n            var later = function() {\r\n                timeout = null;\r\n                if (!immediate) func.apply(context, args);\r\n            };\r\n            var callNow = immediate && !timeout;\r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(later, wait);\r\n            if (callNow) func.apply(context, args);\r\n        };\r\n    };\r\n\r\n    function search(url,field,caption,linkUrl,selector,attribute,cat) {\r\n        $.ajax({\r\n            type:'POST',\r\n            url:url,\r\n            data: { search_term:$('#input-tags6').val().replace(/[`~!@#$%^&*()_|+\\-=?;:'\",.<>\\{\\}\\[\\]\\\\\\/]/gi, \"\"),field:field},\r\n            success:function(data){\r\n                var items=[];\r\n                var result=\"\";\r\n                var newItem=false;\r\n                for(var i=0;i<data.total;i++){\r\n                    if(data[field].hits.hits[i]){\r\n                        if(items.length===0){\r\n                            items.push({\r\n                                name:data[field].hits.hits[i]._source.name,\r\n                                lName:data[field].hits.hits[i]._source.lName,\r\n                                nameHighlight:data[field].hits.hits[i].highlight.name?data[field].hits.hits[i].highlight.name[0]:undefined,\r\n                                lNameHighlight:data[field].hits.hits[i].highlight.lName?data[field].hits.hits[i].highlight.lName[0]:undefined,\r\n                                id:data[field].hits.hits[i]._id,\r\n                                count:1\r\n                            });\r\n                        }else{\r\n                            for(var j=0;j<items.length;j++){\r\n                                if(items[j].name===data[field].hits.hits[i]._source.name || items[j].name===data[field].hits.hits[i]._source.lName){\r\n                                    items[j].count+=1;\r\n                                    newItem=true;\r\n                                    break;\r\n                                }\r\n                            }\r\n                            if(!newItem){\r\n                                items.push({\r\n                                    name:data[field].hits.hits[i]._source.name,\r\n                                    lName:data[field].hits.hits[i]._source.lName,\r\n                                    nameHighlight:data[field].hits.hits[i].highlight.name?data[field].hits.hits[i].highlight.name[0]:undefined,\r\n                                    lNameHighlight:data[field].hits.hits[i].highlight.lName?data[field].hits.hits[i].highlight.lName[0]:undefined,\r\n                                    id:data[field].hits.hits[i]._id,\r\n                                    count:1\r\n                                });\r\n                                // newItem=false;\r\n                            }\r\n                            newItem=false;\r\n                        }\r\n                        }\r\n\r\n                }\r\n                console.log(items);\r\n                for(var i=0;i<items.length;i++){\r\n                    if(attribute){\r\n\r\n                        result+=\"<li style='border-bottom: 1px dashed #eee;padding-bottom: 5px;'>\" +\"   \" +\r\n                            \"   <a style='font-size: 13px;color: #14365d;font-weight: bold;' \" +\r\n                            \"       href='\"+\"/shelf?cat=\"+cat+\"&page=1&per_page=20&q[\"+attribute+\"][0]=\"+items[i].id+\"'>\" +\r\n                            \"    \"+(items[i]['nameHighlight']===undefined?items[i]['nameHighlight']||\r\n                                items[i]['name']:items[i]['nameHighlight'])\r\n                            // +\"  </a>\" + count>1?\"<span >\"+count+\"</span>\":\"\"\r\n                             +//\"-\"+item._score+\r\n                            \"</li>\";\r\n                    }else{\r\n                        if(items[i].count>1){\r\n                            result+=\"<li style='border-bottom: 1px dashed #eee;padding-bottom: 5px;'>\" +\"   \" +\r\n                                \"<a style='padding-left: 5px;font-size: 13px;color: #14365d;font-weight: bold;' href='/search?search=\"+(items[i]['name']||items[i]['lName'])+\"'>\" +\r\n                                \"    \"+(items[i]['nameHighlight']===undefined?items[i]['lNameHighlight']||items[i]['name']:items[i]['nameHighlight'])+\"\" +\r\n                                \"</a>\" +\r\n                                \"<span class='badge' style='vertical-align: initial;    background-color: #ae0000;' >\"+(items[i].count>99?99:items[i].count)+\"</span>\" +//\"-\"+item._score+\r\n                                \"</li>\";\r\n\r\n                        }else{\r\n                            result+=\"<li style='border-bottom: 1px dashed #eee;padding-bottom: 5px;'>\" +\"   \" +\r\n                                \"<a style='font-size: 13px;color: #14365d;font-weight: bold;' href='\"+linkUrl+items[i].id+\"'> \"+(items[i]['nameHighlight']===undefined?items[i]['lNameHighlight']||items[i]['name']:items[i]['nameHighlight'])+\"</a>\" +//\"-\"+item._score+\r\n                                \"</li>\";\r\n                        }\r\n                    }\r\n                }\r\n                console.log(result);\r\n\r\n                $(\"#\"+selector).html(\r\n                    \"<ul style='line-height: 25px;'>\"+result+\"</ul>\"\r\n                );\r\n\r\n\r\n\r\n                if($(\"#input-tags6\").val() ){\r\n                    // $('#input-tags6').popover('hide');\r\n                    $(\"#searchBox\").fadeIn('slow');\r\n                }else{\r\n                    $(\"#searchBox\").fadeOut('500');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function searchMulti() {\r\n        // console.log($('#input-tags6').val());\r\n        if($('#input-tags6').val().replace(/[`~!@#$%^&*()_|+\\-=?;:'\",.<>\\{\\}\\[\\]\\\\\\/]/gi, \"\").trim()){\r\n            $(\"#searchPreview_Main\").css(\"display\",\"none\");\r\n            $(\"#searchPreview_Product\").css(\"display\",\"none\");\r\n            $(\"#searchPreview_writingTools\").css(\"display\",\"none\");\r\n\r\n            if($(\"#searchFilterSelect\").val()==1){\r\n                $(\"#searchPreview_Main\").css(\"display\",\"block\");\r\n                search(\"/admin/api/searchProducts\",\"products\",\"محصول\",\"/product/\",\"main_books\");\r\n                search(\"/admin/api/searchWritingTools\",\"writingtools\",\"محصول\",\"/product/\",\"main_writingtools\");\r\n            }else if($(\"#searchFilterSelect\").val()==2){\r\n                $(\"#searchPreview_Product\").css(\"display\",\"block\");\r\n                search(\"/admin/api/searchProducts\",\"products\",\"محصول\",\"/product/\",\"product_products\");\r\n                search(\"/admin/api/searchPerson\",\"persons\",\"نویسنده\",\"/\",\"product_persons\",6,2);\r\n                search(\"/admin/api/searchPublisher\",\"publishers\",\"ناشر\",\"/\",\"product_publishers\",8,2);\r\n            }else if($(\"#searchFilterSelect\").val()==2999){\r\n                $(\"#searchPreview_writingTools\").css(\"display\",\"block\");\r\n                search(\"/admin/api/searchWritingTools\",\"writingtools\",\"محصول\",\"/product/\",\"writingTool_writingTool\");\r\n                search(\"/admin/api/searchProducer\",\"producers\",\"محصول\",\"/\",\"writingTool_producer\",63,2999);\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    $(\"#input-tags6\").keyup(debounce(\r\n        searchMulti,700)\r\n    );\r\n\r\n\r\n    $('#searchForm').click(function (event) {\r\n        if($(\"#input-tags6\").val()){\r\n            $(\"#searchBox\").fadeIn('slow');\r\n            event.stopPropagation();\r\n        }\r\n    });\r\n\r\n    $('body').click(function () {\r\n        $(\"#searchBox\").fadeOut('500');\r\n    });\r\n\r\n    $(\"#show_more_search\").click(function () {\r\n        $('#searchSubmit').click();\r\n    });\r\n\r\n\r\n\r\n    $('#searchFilterSelect').on('change', function() {\r\n        localStorage.showSearchHint=true;\r\n        $('#input-tags6').popover('disable');\r\n        searchMulti();\r\n    });\r\n\r\n\r\n});\r\n\r\n\r\n\r\n// var $select = $('#input-tags6').selectize({\r\n//     valueField: 'id',\r\n//     labelField: 'name',\r\n//     searchField: 'name',\r\n//     maxItems: 1,\r\n//     loadThrottle: 500,\r\n//     create: true,\r\n//     highlight: false,\r\n//     placeholder : 'جست و جو کنید',\r\n//     addPrecedence : true,\r\n//     maxOptions: 25,\r\n//     filter: false,\r\n//     clearCache: true,\r\n//     plugins: [ 'preserve_on_blur','optgroup_columns' ],\r\n//     create: function (input, callback) {\r\n//         $.ajax({\r\n//             url: '/api/cat/1' /* + $searchCat.val() */ + '/search',\r\n//             data: function (params) {\r\n//                 return {\r\n//                     q: input, // search term\r\n//                     page: 1\r\n//                 };\r\n//             },\r\n//             dataType: 'json',\r\n//             success: function (response) {\r\n//                 return callback(response);\r\n//             }\r\n//         });\r\n//     },\r\n//     render: {\r\n//         option: function(item, escape) {\r\n// //                            console.log(escape(item.suggested));\r\n//             if(item.suggested){\r\n//                 return \"<div class='select2-result-repository__title' data-sname=\" + escape(item.name) + \">\" + escape(item.name) + \"</div>\";\r\n//             }else\r\n//                 return \"<div class='select2-result-repository clearfix'>\" +\r\n//                     \"<div class='select2-result-repository__avatar'style='float: right;margin-left:15px;'><a href='123' class='detail-link'>\" +\r\n//                     \"<img style='max-width: 50px;max-height: 100px;' src='\" + item.img + \"' /></a></div>\" +\r\n//                     \"<div class='select2-result-repository__meta'>\" +\r\n//                     \"<div class='select2-result-repository__title'>\" + escape(item.name) + \"</div>\";\r\n//         },\r\n//         option_create: function(data, escape) {\r\n//             return '<div class=\"create\">کلیدواژه  <strong>' + \" \" + escape(data.input) + \" \" + '</strong>را جست و جو کنید</div>';\r\n//         }\r\n//     },\r\n//     score: function(search) {\r\n//         var score = this.getScoreFunction(search);\r\n//         return function(item) {\r\n//             return 1 ;//+ score(item);\r\n//         };\r\n//     },\r\n//     load: function (query, callback) {\r\n//         for (var o in this.options) {\r\n//             if (this.items.indexOf(o) === -1) {\r\n//                 this.removeOption(o);\r\n//             }\r\n//         }\r\n//         this.renderCache = {};      // clear the html template cache\r\n//         if (!query.length) return callback();\r\n//         if (query.length<3) return callback();\r\n//\r\n//         this.loadedSearches = [];\r\n//         $.ajax({\r\n//             url: '/api/cat/1/search?q=' + query,\r\n//             dataType: 'json',\r\n//             data: {\r\n//                 maxresults: 10\r\n//             },\r\n//             success: function (res) {\r\n//                 if(res.items){\r\n//                     callback(res.items);\r\n//                 }\r\n//             },\r\n//             error: function(xhr,textStatus,err,data,url,res)\r\n//             {\r\n//\r\n//             }\r\n//         });\r\n//     },\r\n//     onItemAdd: function(val, $item) {\r\n//         console.log(val,$item);\r\n//         if(val<200){\r\n//             var query=$item[0].innerHTML;\r\n//             $('#input-tags6-selectized').val($item[0].innerHTML);\r\n//             $('.selectize-dropdown-content').empty();\r\n//             this.clearOptions();\r\n//             this.renderCache = {};\r\n//             var selectize=this;\r\n//             $.ajax({\r\n//                 url: '/api/cat/1/search?q=' + query,\r\n//                 dataType: 'json',\r\n//                 data: {\r\n//                     maxresults: 10\r\n//                 },\r\n//                 success: function (res) {\r\n//                     if(res.items){\r\n//                         $('.selectize-dropdown-content').append(\"\" +\r\n//                             '<div class=\"create\">کلیدواژه  <strong>' + \" \" + query + \" \" + '</strong>را جست و جو کنید</div>' +\r\n//                             \"\");\r\n// //                                        var selectize=this;\r\n//                         res.items.forEach(function (item) {\r\n// //                                        console.log(item.id);\r\n//                             selectize.addOption(item);\r\n// //                                            $('.selectize-dropdown-content').append(\"\" +\r\n// //                                                    \"<div class='select2-result-repository clearfix' data-selectable data-value='\"+item.id+\"'>\" +\r\n// //                                                    \"<div class='select2-result-repository__avatar'style='float: right;margin-left:15px;'><a href='123' class='detail-link'>\" +\r\n// //                                                    \"<img style='max-width: 50px;max-height: 100px;' src='\" + item.img + \"' /></a></div>\" +\r\n// //                                                    \"<div class='select2-result-repository__meta'>\" +\r\n// //                                                    \"<div class='select2-result-repository__title'>\" + item.name + \"</div>\" +\r\n// //                                                    \"\");\r\n//                         });\r\n//                         selectize.refreshOptions();\r\n//                         $('.selectize-dropdown').show();\r\n//                     }\r\n//                 },\r\n//                 error: function(xhr,textStatus,err,data,url,res)\r\n//                 {\r\n//\r\n//                 }\r\n//             });\r\n//         }else{\r\n//             window.location = '/product/' + val;///this.options[val]['id'];\r\n//         }\r\n//     },\r\n//     onDropdownClose: function() {\r\n//         this.clearOptions();\r\n//     }\r\n// });"]}